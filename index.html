<!DOCTYPE html>
<html>
<head>
	<title>Canvas Test</title>
	<style type="text/css">
		canvas { background: #eee; }
	</style>
</head>
<body>

<canvas id="myCanvas" width="480" height="320"></canvas>

<script type="text/javascript">

// Grid dimensions
var gridX = 4;
var gridY = 4;

// Grid definition
var grid = [
    [0,0,0,0],
    [0,0,0,0],
    [0,0,0,0],
    [0,0,0,0]
];

// Pattern that you must copy
var objective = [
    [0,0,0,0],
    [0,1,1,0],
    [0,1,1,0],
    [0,0,0,0]
];


// Grid drawing offset
var gridOffsetX = 50;
var gridOffsetY = 50;

var tileSize = 32;

// Player position
var playerX = 0;
var playerY = 0;

// Whether the player has moved, and how many frames passed since last move
var moved = false;
var waitForNextMove = 0;

// Game state
var state = "playing";

// Canvas definition
var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");

// Keys
var rightPressed = false;
var leftPressed = false;
var upPressed = false;
var downPressed = false;

// Keyboard event listeners
document.addEventListener("keydown", keyDownHandler, false);
document.addEventListener("keyup", keyUpHandler, false);

var n = 0;

function keyDownHandler(e) {
    if(e.key == "Right" || e.key == "ArrowRight") {
        rightPressed = true;
    }
    else if(e.key == "Left" || e.key == "ArrowLeft") {
        leftPressed = true;
    }

    if(e.key == "Up" || e.key == "ArrowUp") {
        upPressed = true;
    }
    else if(e.key == "Down" || e.key == "ArrowDown") {
        downPressed = true;
    }
}

function keyUpHandler(e) {
    if(e.key == "Right" || e.key == "ArrowRight") {
        rightPressed = false;
    }
    else if(e.key == "Left" || e.key == "ArrowLeft") {
        leftPressed = false;
    }

    if(e.key == "Up" || e.key == "ArrowUp") {
        upPressed = false;
    }
    else if(e.key == "Down" || e.key == "ArrowDown") {
        downPressed = false;
    }
}

function drawGrid() {
    for (var i = 0; i < gridX; i++) {
        for (var j = 0; j < gridY; j++) {
            var currentValue = grid[j][i];
            if (currentValue != 0) {
                if (currentValue == 1) {
                    ctx.fillStyle = "#0095DD";
                } else {
                    ctx.fillStyle = "#FF0000";
                }

                ctx.beginPath();
                ctx.arc(i*tileSize+gridOffsetX, j*tileSize+gridOffsetY, 12, 0, Math.PI*2);
                ctx.fill();
                ctx.closePath();
            }
        }
    }
}

function drawPlayer() {
    ctx.beginPath();
    ctx.arc(playerX*tileSize+gridOffsetX, playerY*tileSize+gridOffsetY, 10, 0, Math.PI*2);
    ctx.fillStyle = "#FFFF00";
    ctx.fill();
    ctx.closePath();
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.rect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#000000";
    ctx.fill();
    drawGrid();

    if (state == "playing") {

        if (!moved) {
            // Don't allow diagonal moves
            if (rightPressed) {
                if (playerX < gridX-1) {
                    playerX = Math.min(++playerX, gridX-1);
                    moved = true;
                }            
            } else if (leftPressed) {
                if (playerX > 0) {
                    playerX = Math.max(--playerX, 0);
                    moved = true;
                }            
            } else if (upPressed) {
                if (playerY > 0) {
                    playerY = Math.max(--playerY, 0);
                    moved = true;
                }            
            } else if (downPressed) {
                if (playerY < gridY-1) {
                    playerY = Math.min(++playerY, gridY-1);
                    moved = true;
                }            
            }

            if (moved) {
                var currentValue = grid[playerY][playerX];
                if (currentValue == 0) {
                    grid[playerY][playerX] = 1;
                } else {
                    grid[playerY][playerX] = 0;
                }
            }
        }

    }

    // Wait 10 frames for the next move
    if (moved) {
        if (waitForNextMove < 10) {
            waitForNextMove++;
        } else {
            waitForNextMove = 0;
            moved = false;
        }
    }

    drawPlayer();

    // If the player wins, change state and stop playing
    if (state != "win" && gridsEqual(grid, objective)) {
        alert("You win!!!");
        state = "win";
    }
}

function gridsEqual(grid1, grid2) {
    for (var i = 0; i < gridX; i++) {
        for (var j = 0; j < gridY; j++) {
            var value1 = grid1[j][i];
            var value2 = grid2[j][i];
            console.log("checking " + value1 + " and " + value2);
            if (grid1[j][i] != grid2[j][i]) return false;
        }
    }

    return true;
}

setInterval(draw, 10);
</script>

</body>
</html>